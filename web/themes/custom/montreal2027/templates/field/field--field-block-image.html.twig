{# Extract the image URI from the media object in items[0] and render an <img> element.
   Falls back to printing the original rendered item if a URL can't be resolved. #}
{% set item = items[0] %}
{% set media = item['#media'] ?? item['#entity'] ?? null %}

{# Default values #}
{% set image_uri = null %}
{% set alt_text = '' %}

{# Try common media/image field structures used by Drupal media entities #}
{% if media is not empty %}
  {# media.field_media_image might be the image field on the media entity #}
  {% if media.field_media_image is defined %}
    {# Prefer the first delta if present #}
    {% if media.field_media_image[0] is defined %}
      {% set file_entity = media.field_media_image[0].entity ?? null %}
      {% set alt_text = media.field_media_image[0].alt ?? '' %}
    {% else %}
      {% set file_entity = media.field_media_image.entity ?? null %}
      {# alt may not be available here #}
    {% endif %}

    {% if file_entity is not empty and file_entity.uri is defined %}
      {% set image_uri = file_entity.uri.value ?? file_entity.uri ?? null %}
    {% endif %}
  {% endif %}
{% endif %}

{# If we found a URI, print an <img> with a URL generated by file_url(); otherwise render the original item #}
{% if image_uri %}
  <img src="{{ file_url(image_uri) }}" alt="{{ alt_text|default('')|e }}" />
{% else %}
  {{ items[0] }}
{% endif %}
